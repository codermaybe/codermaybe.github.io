# PBFT共识机制

在分布式系统和区块链领域，**PBFT（Practical Byzantine Fault Tolerance，实用拜占庭容错）** 是一种经典共识算法，旨在应对节点故障和恶意行为。

## PBFT的本质

PBFT由Miguel Castro和Barbara Liskov于1999年提出，用于解决拜占庭将军问题。它确保系统在至多1/3节点发生任意故障（包括恶意行为）时仍能达成一致，适用于节点数量有限的分布式网络。

## PBFT的工作原理

PBFT通过三阶段协议实现共识，假设总节点数`n`，最大容错节点数`f`，需满足`n ≥ 3f + 1`：
1. **预准备（Pre-prepare）**：主节点接收客户端请求，分配序列号并广播提议。
2. **准备（Prepare）**：各节点验证提议合法性，广播准备消息，需收到`2f + 1`个一致确认。
3. **提交（Commit）**：节点收到`2f + 1`个准备确认后广播提交，达成共识并执行。

若主节点失效，视图切换（View Change）机制触发，选举新主节点。通信复杂度为`O(n²)`。

## PBFT的优缺点

### 优点
- **强容错性**：可容忍不超过`(n-1)/3`个拜占庭节点。
- **高效性**：无需算力竞争，延迟低。
- **最终性**：达成共识后状态不可逆。

### 缺点
- **扩展性差**：节点数增加时通信开销激增。
- **前提条件**：需已知节点身份，不适合完全开放系统。

## PBFT的应用

PBFT常见于许可链，如Hyperledger Fabric的共识模块，以及Tendermint（Cosmos SDK基础）。它适用于金融、供应链等需高效一致性的场景。