<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>账户模型</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/codermaybe" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="账户模型"><a class="header" href="#账户模型">账户模型</a></h1>
<p><a href="https://solana.com/nl/docs/core/accounts">官方链接</a></p>
<p><img src="image.png" alt="alt text" /></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Account{
    pub lamports:u64,
    pub data:Vec&lt;u8&gt;,
    pub owner:Pubkey,
    pub excutable:bool,
    pub rent_epoch:Epoch,
}
<span class="boring">}</span></code></pre></pre>
<p>结构分析：</p>
<table>
  <tr>
    <th>字段</th>
    <th>类型</th>
    <th>作用</th>
  </tr>
  <tr>
    <td>lamports</td>
    <td>u64</td>
    <td>表示账户的 SOL 余额，以 Lamports 为单位。1 SOL = 1,000,000,000 Lamports(10^9)。用于支付交易费用和账户租金。</td>
  </tr>
  <tr>
    <td>data</td>
    <td>Vec<u8></td>
    <td>存储账户的实际数据内容。对于普通账户，可以存储任意应用数据；对于程序账户，存储智能合约的二进制代码。</td>
  </tr>
  <tr>
    <td>owner</td>
    <td>Pubkey</td>
    <td>表示账户的所有者，即拥有和控制该账户的公钥。决定谁可以修改账户数据或转移余额。</td>
  </tr>
  <tr>
    <td>executable</td>
    <td>bool</td>
    <td>标识该账户是否为可执行账户。当为 `true` 时，表示账户存储的是可执行的智能合约；否则，为普通账户。</td>
  </tr>
  <tr>
    <td>rent_epoch</td>
    <td>Epoch</td>
    <td>表示账户的租金周期，用于管理账户的存储租金。帮助系统确定是否需要收取新的租金或清除未支付租金的账户。</td>
  </tr>
</table>
<h3 id="关键字说明"><a class="header" href="#关键字说明">关键字说明</a></h3>
<p>• <strong>lamports (<code>u64</code>)</strong>：
• <strong>类型</strong>：无符号 64 位整数 (<code>u64</code>)。
• <strong>作用</strong>：账户的 SOL 余额，以 Lamports 为单位。用于支付交易费用和账户租金，确保账户持有足够的余额以维持其在区块链上的存在。</p>
<p>• <strong>data (<code>Vec&lt;u8&gt;</code>)</strong>：
• <strong>类型</strong>：动态字节向量 (<code>Vec&lt;u8&gt;</code>)。
• <strong>作用</strong>：存储账户的实际数据。对于普通账户，可以存储任意应用数据，如代币余额、NFT 元数据等；对于程序账户，存储智能合约的二进制代码，决定账户的行为和功能。</p>
<p>• <strong>owner (<code>Pubkey</code>)</strong>：
• <strong>类型</strong>：公钥 (<code>Pubkey</code>) <mark>--solana自定义类型，非rust原生</mark>。
• <strong>作用</strong>：标识账户的所有者。只有所有者（或被授权的程序）才能修改账户数据或转移账户余额。公钥用于验证交易的签名，确保账户的安全性和控制权。</p>
<p>• <strong>executable (<code>bool</code>)</strong>：
• <strong>类型</strong>：布尔值 (<code>bool</code>)。
• <strong>作用</strong>：标识账户是否为可执行账户。当设置为 <code>true</code> 时，表示该账户存储的是可执行的智能合约；否则，为普通账户，用于存储数据和资产。</p>
<p>• <strong>rent_epoch (<code>Epoch</code>)</strong>：
• <strong>类型</strong>：Epoch 类型，表示区块链的一个时间周期<mark>--solana自定义类型，非rust原生</mark>。
• <strong>作用</strong>：用于管理账户的存储租金。系统根据账户的 <code>rent_epoch</code> 来确定是否需要收取新的租金，或者是否因未支付租金而清除账户数据，以优化存储资源的使用。</p>
<blockquote>
<p>rent_epoch ：这是从 Solana 有定期从账户扣除 lamports 的机制时遗留下来的一个旧字段。虽然这个字段在 Account 类型中仍然存在，但由于租金收集已被弃用，它不再被使用。</p>
</blockquote>
<h3 id="示例"><a class="header" href="#示例">示例</a></h3>
<p>假设你有一个 Solana 账户，其 <code>Account</code> 结构体实例可能如下所示：</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let account = Account {
    lamports: 1_000_000_000, // 1 SOL
    data: vec![0, 1, 2, 3],  // 存储的数据
    owner: "G1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF".parse().unwrap(), // 所有者公钥
    executable: false,       // 普通账户
    rent_epoch: 123,         // 当前租金周期
};
<span class="boring">}</span></code></pre></pre>
<h2 id="原生程序native-programs"><a class="header" href="#原生程序native-programs">原生程序(Native Programs)</a></h2>
<blockquote>
<p>以下大部分为对solana官方文档的翻译，如有谬误请联系指正！</p>
</blockquote>
<h4 id="系统程序"><a class="header" href="#系统程序">系统程序：</a></h4>
<p>1.创建链上所有的新账户</p>
<p>2.为账户分配数据空间</p>
<p>3.转移账户所有权到自定义程序中</p>
<h4 id="bpf加载器"><a class="header" href="#bpf加载器">BPF加载器</a></h4>
<p>全称Berkeley Packet Filter Loader（伯克利包过滤器加载器），但在Solana中演变为自定义程序的托管者
1.所有已部署的自定义程序的所有者</p>
<p>2.处理程序部署和升级</p>
<ul>
<li>
<h3 id="系统程序system-program"><a class="header" href="#系统程序system-program">系统程序(System Program)</a></h3>
所有在 Solana 上的“钱包”账户都只是由系统程序拥有的账户。这些账户中存储的 lamport 余额代表钱包拥有的 SOL 数量。只有由系统程序拥有的账户才能用作交易费用支付者。
<img src="image-1.png" alt="alt text" /></li>
<li>
<h3 id="bpf-loader"><a class="header" href="#bpf-loader">BPF Loader</a></h3>
BPF 加载器是网络上所有自定义程序的所有者，不包括其他原生程序。它负责部署、升级和执行自定义程序。</li>
</ul>
<hr/>
<h2 id="系统变量账户sysvar-accounts"><a class="header" href="#系统变量账户sysvar-accounts">系统变量账户(Sysvar Accounts)</a></h2>
<p>Sysvar 账户是位于预定义地址的特殊账户，提供对集群状态数据的访问。这些账户会动态更新关于网络集群的数据。您可以在<a href="https://docs.anza.xyz/runtime/sysvars">此处</a>找到 Sysvar 账户的完整列表。</p>
<h2 id="自定义程序custom-programs"><a class="header" href="#自定义程序custom-programs">自定义程序(Custom Programs)</a></h2>
<p>在 Solana 上，“智能合约”被称为程序。程序是包含可执行代码的账户。您可以通过“可执行”标志设置为 true 来识别程序账户。
程序被部署到网络中，可以被用户和其他程序调用以执行它们的指令。</p>
<h2 id="程序账户program-account"><a class="header" href="#程序账户program-account">程序账户(Program Account)</a></h2>
<p>当新的程序目前在 Solana 上部署时，技术上会创建三个独立的账户：</p>
<ul>
<li>程序账户：代表链上程序的账户。此账户存储可执行数据账户的地址（存储编译后的程序代码）以及程序的更新权限（有权对程序进行更改的地址）。</li>
<li>程序可执行数据账户：包含程序可执行代码的账户。</li>
<li>缓冲账户：在程序部署或升级期间创建的临时账户，用于存储程序的执行代码。成功部署后，代码将被移动到程序执行数据账户，缓冲账户将被关闭。</li>
</ul>
<p>例如，以下是 Token Extensions Program Account 及其对应的 Program Executable Data Account 在 Solana Explorer 中的链接。
<img src="image-2.png" alt="alt text" />
为了简单起见，你可以将程序账户视为程序本身。当调用程序的指令时，你指定程序账户的地址（通常称为“程序 ID”）。关于两个独立账户的详细信息主要是为了理解程序是如何部署和升级的。
<img src="image-3.png" alt="alt text" /></p>
<h2 id="数据账户data-account"><a class="header" href="#数据账户data-account">数据账户(Data Account)</a></h2>
<p>Solana 上的程序是“无状态的”，这意味着程序账户仅存储可执行代码，不存储用于读取的数据。
为了维护状态，程序定义指令以创建由程序拥有的单独账户。每个账户都有自己的唯一地址，可以存储程序定义的任何任意数据。
<img src="image-4.png" alt="alt text" />
注意，只有系统程序可以创建新的账户。一旦系统程序创建了账户，它就可以将新账户的所有权转让给另一个程序。
换句话说，为自定义程序创建数据账户需要两个步骤：</p>
<p>1.调用系统程序创建账户，然后将其所有权转让给自定义程序</p>
<p>2.调用现在拥有账户的自定义程序，然后初始化程序指令定义的账户数据</p>
<p>这个账户创建过程通常被抽象为单一步骤。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../BlockChain/Foundry/FoundryGuide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../BlockChain/Solana/Basic/Transactions&amp;Instructions/transactions&amp;instructions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../BlockChain/Foundry/FoundryGuide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../BlockChain/Solana/Basic/Transactions&amp;Instructions/transactions&amp;instructions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
